mod std;

fn main(argc: i64, argv: **const u8) i64 {
    const start = @nanoTimestamp();
    defer {
        @printf("Time to run: %f secs", (@nanoTimestamp() - start) / 1_000_000_000.0);
    }

    const width = 32 as u32;
    const height = 32 as u32;
    const path = "test.bmp";

    const img = std::image::Image::new(width, height);
    defer img.deinit();

    img.fill(std::image::Color::new(255, 255, 255, 255));

    img.fill_rect(
        std::image::Color::new(
            255,   // r
            0, // g
            0, // b
            255  // a
        ),
        4 as u32,  // x
        4 as u32,  // y
        2 as u32,  // w
        2 as u32 // h
    );

    img.fill_rect(
        std::image::Color::new(
            0,   // r
            255, // g
            0, // b
            255  // a
        ),
        10 as u32,  // x
        10 as u32,  // y
        2 as u32,  // w
        2 as u32 // h
    );

    img.fill_rect(
        std::image::Color::new(
            0,   // r
            0, // g
            255, // b
            255  // a
        ),
        16 as u32,  // x
        16 as u32,  // y
        2 as u32,  // w
        2 as u32 // h
    );

    const export_result = img.export_bmp(path);
    if (export_result.is_err()) {
        @printf("[Err: On .BMP file export to file at: '%s'] %d\n", path, export_result.unwrap_err());
        return 1;
    }

    const bytes = export_result.unwrap_ok();
    @printf("Exported %d bytes to file at: '%s'\n", bytes, path);
    return 0;
}